<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GemHub</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * { font-family: 'Noto Sans KR', sans-serif; }
        .gem-card {
            background: #6366f1;
            transition: all 0.3s ease;
        }
        .gem-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.4);
        }
        .pulse-dot {
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .new-gem {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .review-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .review-section.open {
            max-height: 500px;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-900">
    <!-- Header -->
    <header class="py-8 px-4">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-400 mb-2">
                Gem's park
            </h1>
            <p class="text-slate-400 text-lg">Google Gemì„ ê³µìœ í•˜ëŠ” ê³µê°„</p>
            <div id="connectionStatus" class="flex items-center justify-center gap-2 mt-3 text-sm">
                <span class="w-2 h-2 bg-yellow-400 rounded-full pulse-dot"></span>
                <span class="text-yellow-400">ì—°ê²° ì¤‘...</span>
            </div>
        </div>
    </header>

    <!-- Upload Form -->
    <section class="px-4 pb-8">
        <div class="max-w-2xl mx-auto">
            <div class="bg-slate-800 rounded-2xl p-6 border border-slate-700">
                <h2 class="text-xl font-semibold text-white mb-4">
                    ìƒˆ Gem ê³µìœ í•˜ê¸°
                </h2>
                <form id="gemForm" class="space-y-4">
                    <div>
                        <label class="block text-slate-300 text-sm mb-2">Gem ì´ë¦„</label>
                        <input 
                            type="text" 
                            id="gemName" 
                            placeholder="ì˜ˆ: ì½”ë”© ë„ìš°ë¯¸, ì˜ì–´ ì„ ìƒë‹˜..."
                            class="w-full px-4 py-3 rounded-xl bg-slate-700 border border-slate-600 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            required
                        >
                    </div>
                    <div>
                        <label class="block text-slate-300 text-sm mb-2">Gem ê³µìœ  ë§í¬</label>
                        <input 
                            type="url" 
                            id="gemLink" 
                            placeholder="https://gemini.google.com/..."
                            class="w-full px-4 py-3 rounded-xl bg-slate-700 border border-slate-600 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            required
                        >
                    </div>
                    <div>
                        <label class="block text-slate-300 text-sm mb-2">ì„¤ëª… (ì„ íƒ)</label>
                        <textarea 
                            id="gemDesc" 
                            placeholder="ì´ Gemì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…..."
                            rows="2"
                            class="w-full px-4 py-3 rounded-xl bg-slate-700 border border-slate-600 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"
                        ></textarea>
                    </div>
                    <button 
                        type="submit"
                        id="submitBtn"
                        class="w-full py-3 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        Gem ê³µìœ í•˜ê¸°
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- Gems Grid -->
    <section class="px-4 pb-12">
        <div class="max-w-4xl mx-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                    ê³µìœ ëœ Gems
                    <span id="gemCount" class="text-sm bg-indigo-600/30 px-3 py-1 rounded-full text-indigo-300">0ê°œ</span>
                </h2>
            </div>
            
            <!-- Loading State -->
            <div id="loadingState" class="text-center py-16">
                <div class="w-8 h-8 border-4 border-indigo-400 border-t-transparent rounded-full loading-spinner inline-block mb-4"></div>
                <p class="text-slate-400">Gemì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <div id="gemsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Gems will be rendered here -->
            </div>

            <div id="emptyState" class="hidden text-center py-16">
                <p class="text-slate-300 text-lg">ì•„ì§ ê³µìœ ëœ Gemì´ ì—†ìŠµë‹ˆë‹¤</p>
                <p class="text-slate-500 text-sm mt-2">ì²« ë²ˆì§¸ Gemì„ ê³µìœ í•´ë³´ì„¸ìš”!</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-6 text-center text-slate-500 text-sm">
        <p>Made by LBS</p>
        <p class="text-xs mt-1 text-slate-600">ëª¨ë“  ì‚¬ìš©ìì™€ ì‹¤ì‹œê°„ ê³µìœ ë©ë‹ˆë‹¤</p>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-xl shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center gap-2 z-50">
        <span id="toastIcon">âœ…</span> <span id="toastMessage">Gemì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!</span>
    </div>

    <script>
        // ============================================
        // Firebase ì„¤ì • - ë³¸ì¸ì˜ Firebase í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”
        // ============================================
        const firebaseConfig = {
  apiKey: "AIzaSyA2H_f049azQK710uNIdjT4wXqsle4N-qU",
  authDomain: "hong-5638a.firebaseapp.com",
  databaseURL: "https://hong-5638a-default-rtdb.firebaseio.com",
  projectId: "hong-5638a",
  storageBucket: "hong-5638a.firebasestorage.app",
  messagingSenderId: "567566299024",
  appId: "1:567566299024:web:7dfef9a09b2f7306880d15"
};
        // ============================================

        let db = null;
        let gemsRef = null;
        let reviewsRef = null;
        let gemsData = [];

        // Firebase ì´ˆê¸°í™”
        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                gemsRef = db.ref('gems');
                reviewsRef = db.ref('reviews');

                // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
                db.ref('.info/connected').on('value', (snapshot) => {
                    const isConnected = snapshot.val() === true;
                    updateConnectionStatus(isConnected ? 'connected' : 'disconnected');
                });

                // ì‹¤ì‹œê°„ ë°ì´í„° ë¦¬ìŠ¤ë„ˆ
                gemsRef.on('value', (snapshot) => {
                    const gems = [];
                    snapshot.forEach((child) => {
                        gems.push({ id: child.key, ...child.val() });
                    });
                    // ê³ ì •ëœ í•­ëª© ë¨¼ì €, ê·¸ ë‹¤ìŒ ìµœì‹ ìˆœ ì •ë ¬
                    gems.sort((a, b) => {
                        if (a.pinned && !b.pinned) return -1;
                        if (!a.pinned && b.pinned) return 1;
                        return b.createdAt - a.createdAt;
                    });
                    gemsData = gems;
                    renderGems(gems);
                    document.getElementById('loadingState').classList.add('hidden');
                });

            } catch (error) {
                console.error("Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
                updateConnectionStatus('error');
            }
        }

        // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateConnectionStatus(status) {
            const statusEl = document.getElementById('connectionStatus');
            const configs = {
                connected: { color: 'green', text: 'ì‹¤ì‹œê°„ ì—°ê²°ë¨' },
                disconnected: { color: 'red', text: 'ì—°ê²° ëŠê¹€' },
                error: { color: 'red', text: 'ì—°ê²° ì˜¤ë¥˜' }
            };
            const config = configs[status] || configs.disconnected;
            statusEl.innerHTML = `
                <span class="w-2 h-2 bg-${config.color}-400 rounded-full pulse-dot"></span>
                <span class="text-${config.color}-400">${config.text}</span>
            `;
        }

        // Gem ì¶”ê°€
        async function addGem(name, link, description) {
            const newGem = {
                name: name,
                link: link,
                description: description,
                createdAt: Date.now()
            };
            await gemsRef.push(newGem);
        }

        // í›„ê¸° ì¶”ê°€
        async function addReview(gemId, nickname, content) {
            const newReview = {
                gemId: gemId,
                nickname: nickname,
                content: content,
                createdAt: Date.now()
            };
            await reviewsRef.push(newReview);
        }

        // í›„ê¸° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadReviews(gemId) {
            const snapshot = await reviewsRef.orderByChild('gemId').equalTo(gemId).once('value');
            const reviews = [];
            snapshot.forEach((child) => {
                reviews.push({ id: child.key, ...child.val() });
            });
            reviews.sort((a, b) => b.createdAt - a.createdAt);
            return reviews;
        }

        // Format date
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'ë°©ê¸ˆ ì „';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}ë¶„ ì „`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}ì‹œê°„ ì „`;
            if (diff < 604800000) return `${Math.floor(diff / 86400000)}ì¼ ì „`;
            
            return date.toLocaleDateString('ko-KR');
        }

        // í›„ê¸° ì„¹ì…˜ í† ê¸€
        async function toggleReviews(gemId) {
            const section = document.getElementById(`reviews-${gemId}`);
            const reviewsList = document.getElementById(`reviews-list-${gemId}`);
            
            if (section.classList.contains('open')) {
                section.classList.remove('open');
            } else {
                section.classList.add('open');
                // í›„ê¸° ë¡œë“œ
                const reviews = await loadReviews(gemId);
                renderReviewsList(gemId, reviews);
            }
        }

        // í›„ê¸° ëª©ë¡ ë Œë”ë§
        function renderReviewsList(gemId, reviews) {
            const reviewsList = document.getElementById(`reviews-list-${gemId}`);
            
            if (reviews.length === 0) {
                reviewsList.innerHTML = '<p class="text-indigo-200/60 text-sm text-center py-2">ì•„ì§ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
            } else {
                reviewsList.innerHTML = reviews.map(review => `
                    <div class="bg-white/10 rounded-lg p-3 mb-2">
                        <div class="flex items-center justify-between mb-1">
                            <span class="font-medium text-white text-sm">${escapeHtml(review.nickname)}</span>
                            <span class="text-indigo-200/50 text-xs">${formatDate(review.createdAt)}</span>
                        </div>
                        <p class="text-indigo-100/80 text-sm">${escapeHtml(review.content)}</p>
                    </div>
                `).join('');
            }
        }

        // í›„ê¸° ì œì¶œ
        async function submitReview(gemId) {
            const nicknameInput = document.getElementById(`review-nickname-${gemId}`);
            const contentInput = document.getElementById(`review-content-${gemId}`);
            const submitBtn = document.getElementById(`review-submit-${gemId}`);
            
            const nickname = nicknameInput.value.trim();
            const content = contentInput.value.trim();
            
            if (!nickname || !content) {
                showToast('ë‹‰ë„¤ì„ê³¼ í›„ê¸°ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'ë“±ë¡ ì¤‘...';
            
            try {
                await addReview(gemId, nickname, content);
                nicknameInput.value = '';
                contentInput.value = '';
                showToast('í›„ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                // í›„ê¸° ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                const reviews = await loadReviews(gemId);
                renderReviewsList(gemId, reviews);
            } catch (error) {
                console.error(error);
                showToast('í›„ê¸° ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', true);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ë“±ë¡';
            }
        }

        // Render gems
        function renderGems(gems) {
            const container = document.getElementById('gemsContainer');
            const emptyState = document.getElementById('emptyState');
            const gemCount = document.getElementById('gemCount');
            const loadingState = document.getElementById('loadingState');

            loadingState.classList.add('hidden');
            gemCount.textContent = `${gems.length}ê°œ`;

            if (gems.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');

            container.innerHTML = gems.map(gem => `
                <div class="gem-card rounded-2xl p-5 new-gem ${gem.pinned ? 'ring-2 ring-yellow-400' : ''}">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            ${gem.pinned ? '<span class="text-yellow-300 text-xs bg-yellow-500/20 px-2 py-0.5 rounded inline-block mb-2">ğŸ“Œ ê³ ì •</span>' : ''}
                            <h3 class="text-lg font-bold text-white">${escapeHtml(gem.name)}</h3>
                        </div>
                    </div>
                    ${gem.description ? `
                        <p class="text-indigo-100/80 text-sm mb-4 line-clamp-2">${escapeHtml(gem.description)}</p>
                    ` : '<div class="mb-4"></div>'}
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-indigo-200/60 text-xs">${formatDate(gem.createdAt)}</span>
                        <a 
                            href="${escapeHtml(gem.link)}" 
                            target="_blank" 
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-2 bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                        >
                            ë°”ë¡œê°€ê¸° â†’
                        </a>
                    </div>
                    
                    <!-- í›„ê¸° í† ê¸€ ë²„íŠ¼ -->
                    <button 
                        onclick="toggleReviews('${gem.id}')"
                        class="w-full text-left text-indigo-200 hover:text-white text-sm py-2 border-t border-white/20 mt-2 transition-colors flex items-center gap-2"
                    >
                        <span>í›„ê¸° ë³´ê¸° / ë‚¨ê¸°ê¸°</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    
                    <!-- í›„ê¸° ì„¹ì…˜ -->
                    <div id="reviews-${gem.id}" class="review-section">
                        <div class="pt-3 space-y-3">
                            <!-- í›„ê¸° ì‘ì„± í¼ -->
                            <div class="bg-white/10 rounded-lg p-3">
                                <input 
                                    type="text" 
                                    id="review-nickname-${gem.id}"
                                    placeholder="ë‹‰ë„¤ì„"
                                    class="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-indigo-200/50 text-sm focus:outline-none focus:ring-2 focus:ring-white/30 mb-2"
                                    maxlength="20"
                                >
                                <textarea 
                                    id="review-content-${gem.id}"
                                    placeholder="ì´ Gemì— ëŒ€í•œ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”..."
                                    rows="2"
                                    class="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-indigo-200/50 text-sm focus:outline-none focus:ring-2 focus:ring-white/30 resize-none mb-2"
                                    maxlength="200"
                                ></textarea>
                                <button 
                                    id="review-submit-${gem.id}"
                                    onclick="submitReview('${gem.id}')"
                                    class="w-full py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg text-sm font-medium transition-colors"
                                >
                                    ë“±ë¡
                                </button>
                            </div>
                            
                            <!-- í›„ê¸° ëª©ë¡ -->
                            <div id="reviews-list-${gem.id}">
                                <p class="text-indigo-200/60 text-sm text-center py-2">ë¡œë”© ì¤‘...</p>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Show toast notification
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');
            
            toastMessage.textContent = message;
            toastIcon.textContent = isError ? 'âŒ' : 'âœ…';
            toast.className = toast.className.replace(/bg-\w+-500/, isError ? 'bg-red-500' : 'bg-green-500');
            toast.classList.remove('translate-y-20', 'opacity-0');
            
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // Form submission
        document.getElementById('gemForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const name = document.getElementById('gemName').value.trim();
            const link = document.getElementById('gemLink').value.trim();
            const description = document.getElementById('gemDesc').value.trim();

            if (!name || !link) return;

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="w-5 h-5 border-2 border-white border-t-transparent rounded-full loading-spinner inline-block"></span> ê³µìœ  ì¤‘...';

            try {
                await addGem(name, link, description);
                showToast('ìƒˆ Gemì´ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!');
                this.reset();
            } catch (error) {
                console.error(error);
                showToast('ê³µìœ  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', true);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Gem ê³µìœ í•˜ê¸°';
            }
        });

        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', initFirebase);
    </script>
</body>
</html>
